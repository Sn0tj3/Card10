.pages: &pages
  image:
    name: klakegg/hugo:ext-nodejs
    entrypoint: [""]
  variables:
    GIT_SUBMODULE_STRATEGY: recursive
  script:
     - git status
     - git submodule foreach git pull origin master
     - pushd content
     - git status
     - popd
     - yarn add sass
     - ./node_modules/.bin/sass style/main.scss static/css/main.css
     - hugo
  artifacts:
    paths:
      - public
    expire_in: 10m


test pages:
  <<: *pages
  except:
   - master


# Seperated otherwise merge requests would 
# replace the real site
pages:
  <<: *pages
  only:
   - master
